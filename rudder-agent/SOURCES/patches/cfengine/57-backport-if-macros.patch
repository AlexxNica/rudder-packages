From 7e7f8303c1f191472be39a66792c247555f6d98a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Beno=C3=AEt=20Peccatte?= <benoit.peccatte@normation.com>
Date: Thu, 15 Oct 2015 18:23:59 +0200
Subject: [PATCH] Add acceptance tests for both feature and patch level

---
 tests/acceptance/00_basics/macros/if_feature.cf | 43 ++++++++++++++++++++++
 tests/acceptance/00_basics/macros/if_triple.cf  | 48 +++++++++++++++++++++++++
 2 files changed, 91 insertions(+)
 create mode 100644 tests/acceptance/00_basics/macros/if_feature.cf
 create mode 100644 tests/acceptance/00_basics/macros/if_triple.cf

diff --git a/tests/acceptance/00_basics/macros/if_feature.cf b/tests/acceptance/00_basics/macros/if_feature.cf
new file mode 100644
index 0000000..2495116
--- /dev/null
+++ b/tests/acceptance/00_basics/macros/if_feature.cf
@@ -0,0 +1,43 @@
+######################################################
+#
+#  Test that @if feature() wirks
+#
+#####################################################
+
+body common control
+{
+      inputs => { "../../default.cf.sub" };
+      bundlesequence  => { default("$(this.promise_filename)") };
+      version => "1.0";
+}
+
+bundle common test
+{
+@if feature(xml)
+  classes:
+      "expected" expression => "any";
+@endif
+
+@if feature(yaml)
+  classes:
+      "expected2" expression => "any";
+@endif
+
+@if feature(unknown_123)
+  classes:
+      "not_expected" expression => "any";
+@endif
+}
+
+bundle agent check
+{
+  methods:
+      "" usebundle => dcs_passif_expected("expected,expected2,expected2",
+                                         "not_expected",
+                                         $(this.promise_filename));
+}
+
+@if feature(ABCD)
+
+This text should never be seen, it's completely ignored
+@endif
diff --git a/tests/acceptance/00_basics/macros/if_triple.cf b/tests/acceptance/00_basics/macros/if_triple.cf
new file mode 100644
index 0000000..896a2b2
--- /dev/null
+++ b/tests/acceptance/00_basics/macros/if_triple.cf
@@ -0,0 +1,48 @@
+######################################################
+#
+#  Test that @if works with patch level
+#
+#####################################################
+
+body common control
+{
+      inputs => { "../../default.cf.sub" };
+      bundlesequence  => { default("$(this.promise_filename)") };
+      version => "1.0";
+}
+
+bundle common test
+{
+@if minimum_version(3.5.100)
+  classes:
+      "expected" expression => "any";
+@endif
+
+@if minimum_version(3.6.0)
+  classes:
+      "expected2" expression => "any";
+@endif
+
+@if minimum_version(2.100.0)
+  classes:
+      "expected_2_100" expression => "any";
+@endif
+
+@if minimum_version(3.8.300)
+  classes:
+      "not_expected" expression => "any";
+@endif
+}
+
+bundle agent check
+{
+  methods:
+      "" usebundle => dcs_passif_expected("expected,expected2,expected_2_100",
+                                         "not_expected",
+                                         $(this.promise_filename));
+}
+
+@if minimum_version(300.600.0)
+
+This text should never be seen, it's completely ignored
+@endif
