From 9229db44efd314aca81b27e6b140c6ed7f4867f9 Mon Sep 17 00:00:00 2001
From: Ted Zlatanov <tzz@lifelogs.com>
Date: Thu, 18 Jun 2015 11:17:13 -0400
Subject: [PATCH] Redmine#7281: rename version_after macro to minimum_version

---
 libpromises/cf3lex.l                                         |  4 ++--
 tests/acceptance/00_basics/macros/if.cf                      | 10 +++++-----
 tests/acceptance/00_basics/macros/if_eof_without_endif.x.cf  |  2 +-
 tests/acceptance/00_basics/macros/if_eof_without_endif2.x.cf |  2 +-
 tests/acceptance/00_basics/macros/if_mismatched.x.cf         | 12 ++++++------
 tests/acceptance/00_basics/macros/if_multiple_endif.x.cf     |  8 ++++----
 tests/acceptance/00_basics/macros/if_nested.x.cf             | 10 +++++-----
 8 files changed, 25 insertions(+), 25 deletions(-)

diff --git a/libpromises/cf3lex.l b/libpromises/cf3lex.l
index bda664c..a8bbf27 100644
--- a/libpromises/cf3lex.l
+++ b/libpromises/cf3lex.l
@@ -79,7 +79,7 @@ line       ^.*$
 
 comment    #[^\n]*
 
-macro_if    ^@if\ version_after\([0-9]{1,10}\.[0-9]{1,10}\)
+macro_if    ^@if\ minimum_version\([0-9]{1,10}\.[0-9]{1,10}\)
 macro_endif ^@endif
 
 promises   bundle
@@ -140,7 +140,7 @@ promise_type   [a-zA-Z_]+:
                       }
 
 {macro_if}            {
-                        const char* version_text = yytext+18;
+                        const char* version_text = yytext+20;
                         ParserDebug("\tL:macro @if %d:version=%s\n", P.line_pos, version_text);
                         {
                           int request_major = 0;
diff --git a/tests/acceptance/00_basics/macros/if.cf b/tests/acceptance/00_basics/macros/if.cf
index ee690bb..c6442eb 100644
--- a/tests/acceptance/00_basics/macros/if.cf
+++ b/tests/acceptance/00_basics/macros/if.cf
@@ -13,22 +13,22 @@ body common control
 
 bundle common test
 {
-@if version_after(3.6)
+@if minimum_version(3.6)
   classes:
       "expected" expression => "any";
 @endif
 
-@if version_after(3.5)
+@if minimum_version(3.5)
   classes:
       "expected2" expression => "any";
 @endif
 
-@if version_after(2.100)
+@if minimum_version(2.100)
   classes:
       "expected_2_100" expression => "any";
 @endif
 
-@if version_after(300.700)
+@if minimum_version(300.700)
   classes:
       "not_expected" expression => "any";
 @endif
@@ -42,7 +42,7 @@ bundle agent check
                                          $(this.promise_filename));
 }
 
-@if version_after(300.600)
+@if minimum_version(300.600)
 
 This text should never be seen, it's completely ignored
 @endif
diff --git a/tests/acceptance/00_basics/macros/if_eof_without_endif.x.cf b/tests/acceptance/00_basics/macros/if_eof_without_endif.x.cf
index 6622bcc..4d8c4ec 100644
--- a/tests/acceptance/00_basics/macros/if_eof_without_endif.x.cf
+++ b/tests/acceptance/00_basics/macros/if_eof_without_endif.x.cf
@@ -19,6 +19,6 @@ bundle agent check
                                          $(this.promise_filename));
 }
 
-@if version_after(300.100)
+@if minimum_version(300.100)
 
 This text should never be seen, it's completely ignored
diff --git a/tests/acceptance/00_basics/macros/if_eof_without_endif2.x.cf b/tests/acceptance/00_basics/macros/if_eof_without_endif2.x.cf
index 2d7f369..180d216 100644
--- a/tests/acceptance/00_basics/macros/if_eof_without_endif2.x.cf
+++ b/tests/acceptance/00_basics/macros/if_eof_without_endif2.x.cf
@@ -19,6 +19,6 @@ bundle agent check
                                          $(this.promise_filename));
 }
 
-@if version_after(1.1)
+@if minimum_version(1.1)
 
 # just testing for EOF
diff --git a/tests/acceptance/00_basics/macros/if_mismatched.x.cf b/tests/acceptance/00_basics/macros/if_mismatched.x.cf
index 5a552b6..75c0668 100644
--- a/tests/acceptance/00_basics/macros/if_mismatched.x.cf
+++ b/tests/acceptance/00_basics/macros/if_mismatched.x.cf
@@ -13,8 +13,8 @@ body common control
 
 bundle common test
 {
-@if version_after(3.7)
-@if version_after(3.6)
+@if minimum_version(3.7)
+@if minimum_version(3.6)
   classes:
       "expected" expression => "any";
 @endif
@@ -23,13 +23,13 @@ bundle common test
 @endif
 @endif
 
-@if version_after(3.6)
+@if minimum_version(3.6)
   classes:
       "expected2" expression => "any";
 @endif
 
-@if version_after(300.700)
-@if version_after(3.6)
+@if minimum_version(300.700)
+@if minimum_version(3.6)
   classes:
       "not_expected" expression => "any";
 @endif
@@ -44,7 +44,7 @@ bundle agent check
                                          $(this.promise_filename));
 }
 
-@if version_after(300.600)
+@if minimum_version(300.600)
 
 This text should never be seen, it's completely ignored
 @endif
diff --git a/tests/acceptance/00_basics/macros/if_multiple_endif.x.cf b/tests/acceptance/00_basics/macros/if_multiple_endif.x.cf
index 1d8c4d1..79cbb51 100644
--- a/tests/acceptance/00_basics/macros/if_multiple_endif.x.cf
+++ b/tests/acceptance/00_basics/macros/if_multiple_endif.x.cf
@@ -13,18 +13,18 @@ body common control
 
 bundle common test
 {
-@if version_after(3.7)
+@if minimum_version(3.7)
   classes:
       "expected" expression => "any";
 @endif
 @endif
 
-@if version_after(3.6)
+@if minimum_version(3.6)
   classes:
       "expected2" expression => "any";
 @endif
 
-@if version_after(300.700)
+@if minimum_version(300.700)
   classes:
       "not_expected" expression => "any";
 @endif
@@ -38,7 +38,7 @@ bundle agent check
                                          $(this.promise_filename));
 }
 
-@if version_after(300.600)
+@if minimum_version(300.600)
 
 This text should never be seen, it's completely ignored
 @endif
diff --git a/tests/acceptance/00_basics/macros/if_nested.x.cf b/tests/acceptance/00_basics/macros/if_nested.x.cf
index 55d9ecf..14be0ae 100644
--- a/tests/acceptance/00_basics/macros/if_nested.x.cf
+++ b/tests/acceptance/00_basics/macros/if_nested.x.cf
@@ -13,19 +13,19 @@ body common control
 
 bundle common test
 {
-@if version_after(3.7)
-@if version_after(3.6)
+@if minimum_version(3.7)
+@if minimum_version(3.6)
   classes:
       "expected" expression => "any";
 @endif
 @endif
 
-@if version_after(3.6)
+@if minimum_version(3.6)
   classes:
       "expected2" expression => "any";
 @endif
 
-@if version_after(300.700)
+@if minimum_version(300.700)
   classes:
       "not_expected" expression => "any";
 @endif
@@ -39,7 +39,7 @@ bundle agent check
                                          $(this.promise_filename));
 }
 
-@if version_after(300.600)
+@if minimum_version(300.600)
 
 This text should never be seen, it's completely ignored
 @endif
