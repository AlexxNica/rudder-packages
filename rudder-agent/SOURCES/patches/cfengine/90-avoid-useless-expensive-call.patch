From 1c76412c2c8e70a813f267f5dcd4d17d3aad8693 Mon Sep 17 00:00:00 2001
From: Alexis Mousset <contact@amousset.me>
Date: Wed, 30 Nov 2016 20:34:52 +0100
Subject: [PATCH] CFE-2524: Only call BundleResolvePromiseType when it is
 needed as it is an expensive call

---
 libpromises/expand.c | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/libpromises/expand.c b/libpromises/expand.c
index 002588a..c8b4ecd 100644
--- a/libpromises/expand.c
+++ b/libpromises/expand.c
@@ -647,14 +647,14 @@ void BundleResolve(EvalContext *ctx, const Bundle *bundle)
         "Resolving classes and variables in 'bundle %s %s'",
         bundle->type, bundle->name);
 
-    /* Necessary to parse vars *before* classes for cases like this:
-     * 00_basics/04_bundles/dynamic_bundlesequence/dynamic_inputs_based_on_class_set_using_variable_file_control_extends_inputs.cf.sub
-     *   --  see bundle "classify". */
-    BundleResolvePromiseType(ctx, bundle, "vars", VerifyVarPromise);
-
     /* PRE-EVAL: evaluate classes of common bundles. */
     if (strcmp(bundle->type, "common") == 0)
     {
+        /* Necessary to parse vars *before* classes for cases like this:
+         * 00_basics/04_bundles/dynamic_bundlesequence/dynamic_inputs_based_on_class_set_using_variable_file_control_extends_inputs.cf.sub
+         *   --  see bundle "classify". */
+        BundleResolvePromiseType(ctx, bundle, "vars", VerifyVarPromise);
+
         BundleResolvePromiseType(ctx, bundle, "classes", VerifyClassPromise);
     }
 
