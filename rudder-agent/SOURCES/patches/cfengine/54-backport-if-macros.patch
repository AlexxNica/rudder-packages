From 83d0755f653b24ab81c88fdd4f83218ad4d59b94 Mon Sep 17 00:00:00 2001
From: Ted Zlatanov <tzz@lifelogs.com>
Date: Tue, 12 May 2015 17:13:57 -0400
Subject: [PATCH] Redmine#6180: add feature_yaml and feature_xml and adjust
 tests

---
 libenv/sysinfo.c                                   |  7 ++++
 tests/acceptance/01_vars/02_functions/readdata.cf  |  6 +--
 .../01_vars/02_functions/readdata.cf.expected.json | 24 -----------
 .../01_vars/02_functions/readdata.cf.yaml          | 10 -----
 .../01_vars/02_functions/readdata.cf.yaml.guess    | 10 -----
 .../01_vars/02_functions/readdata_yaml.cf          | 41 ++++++++++++++++++
 .../02_functions/readdata_yaml.cf.expected.json    | 26 ++++++++++++
 .../01_vars/02_functions/readdata_yaml.cf.yaml     | 10 +++++
 .../02_functions/readdata_yaml.cf.yaml.guess       | 10 +++++
 .../01_vars/04_containers/inline_json.cf           | 15 -------
 .../04_containers/inline_json.cf.expected.json     | 16 -------
 .../01_vars/04_containers/inline_yaml.cf           | 49 ++++++++++++++++++++++
 .../04_containers/inline_yaml.cf.expected.json     | 19 +++++++++
 13 files changed, 163 insertions(+), 80 deletions(-)
 delete mode 100644 tests/acceptance/01_vars/02_functions/readdata.cf.yaml
 delete mode 100644 tests/acceptance/01_vars/02_functions/readdata.cf.yaml.guess
 create mode 100644 tests/acceptance/01_vars/02_functions/readdata_yaml.cf
 create mode 100644 tests/acceptance/01_vars/02_functions/readdata_yaml.cf.expected.json
 create mode 100644 tests/acceptance/01_vars/02_functions/readdata_yaml.cf.yaml
 create mode 100644 tests/acceptance/01_vars/02_functions/readdata_yaml.cf.yaml.guess
 create mode 100644 tests/acceptance/01_vars/04_containers/inline_yaml.cf
 create mode 100644 tests/acceptance/01_vars/04_containers/inline_yaml.cf.expected.json

diff --git a/libenv/sysinfo.c b/libenv/sysinfo.c
index 7575103..baff740 100644
--- a/libenv/sysinfo.c
+++ b/libenv/sysinfo.c
@@ -947,6 +947,13 @@ static void BuiltinClasses(EvalContext *ctx)
     snprintf(vbuff, CF_BUFSIZE, "cfengine_%s", CanonifyName(Version()));
     CreateHardClassesFromCanonification(ctx, vbuff, "inventory,attribute_name=none,source=agent");
 
+#ifdef HAVE_LIBXML2
+    CreateHardClassesFromCanonification(ctx, "feature_xml", "source=agent");
+#endif
+
+#ifdef HAVE_LIBYAML
+    CreateHardClassesFromCanonification(ctx, "feature_yaml", "source=agent");
+#endif
 }
 
 /*******************************************************************/
