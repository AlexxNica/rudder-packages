diff -Naurw rudder-agent-thin/SPECS/rudder-agent.spec rudder-agent-thin-new/SPECS/rudder-agent.spec
--- a/rudder-agent.spec	2014-06-02 15:06:39.853856384 +0200
+++ b/rudder-agent.spec	2014-06-03 14:47:26.554384425 +0200
@@ -17,7 +17,7 @@
 #####################################################################################
 
 #=================================================
-# Specification file for rudder-agent
+# Specification file for rudder-agent-thin
 #
 # Install CFEngine
 # Install Rudder initial promises
@@ -29,7 +29,7 @@
 #=================================================
 # Variables
 #=================================================
-%define real_name            rudder-agent
+%define real_name            rudder-agent-thin
 
 %define rudderdir            /opt/rudder
 %define ruddervardir         /var/rudder
@@ -65,18 +65,12 @@
 Source8: vzps.py
 Source9: rudder-agent.sh
 Source10: detect_os.sh
-Source11: rudder-perl
 
 # uuidgen doesn't exist on AIX, so we provide a simple shell compatible version
 %if "%{?_os}" == "aix"
 Source100: uuidgen
 %endif
 
-# Prevent dependency auto-generation, that tries to be helpful by detecting Perl dependencies from
-# FusionInventory. We handle that with the perl standalone installation already.
-AutoReq: 0
-AutoProv: 0
-
 %if 0%{?rhel} == 4
 Patch1: fix-missing-headers
 %endif
@@ -85,7 +79,9 @@
 
 #Generic requirement
 BuildRequires: gcc openssl-devel bison flex pcre-devel autoconf automake libtool
-Requires: pcre openssl
+Requires: pcre openssl fusioninventory-agent fusioninventory-agent-task-inventory
+Provides: rudder-agent
+Obsoletes: rudder-agent
 
 # Specific requirements
 
@@ -143,23 +139,11 @@
 %define cp_a_command           cp -hpPr
 %endif
 
-# Replaces rudder-cfengine-community since 2.4.0~beta3
-Provides: rudder-cfengine-community
-Obsoletes: rudder-cfengine-community
-
-# Use our own dependency generator
-%global _use_internal_dependency_generator 0
-%global __find_requires_orig %{__find_requires}
-%define __find_requires %{_sourcedir}/filter-reqs.pl %{is_lmdb_here} %{__find_requires_orig}
-%global __find_provides_orig %{__find_provides}
-%define __find_provides %{_sourcedir}/filter-reqs.pl %{is_lmdb_here} %{__find_provides_orig}
-
 %description
 Rudder is an open source configuration management and audit solution.
 
 This package contains the agent that must be installed on all nodes to be
-managed by Rudder. It is based on two main components: CFEngine Community 3 and
-FusionInventory.
+managed by Rudder. It is based on CFEngine Community.
 
 #=================================================
 # Source preparation
@@ -176,8 +160,6 @@
 
 cd %{_sourcedir}
 
-%{_sourcedir}/perl-prepare.sh %{_sourcedir}/fusioninventory-agent
-
 # Ensure an appropriate environment for the compiler
 export CFLAGS="$RPM_OPT_FLAGS"
 export CXXFLAGS="$RPM_OPT_FLAGS"
@@ -259,9 +241,6 @@
 # Initial promises
 cp -r %{_sourcedir}/initial-promises %{buildroot}%{rudderdir}/share/
 
-# Fusion
-%{cp_a_command} %{_sourcedir}/perl-custom/opt/rudder/* %{buildroot}%{rudderdir}
-
 # Wrapper script
 %{install_command} -m 755 %{SOURCE3} %{buildroot}/opt/rudder/bin/run-inventory
 
@@ -280,8 +259,6 @@
 
 %{install_command} -m 755 %{SOURCE8} %{buildroot}/opt/rudder/bin/vzps.py
 
-%{install_command} -m 755 %{SOURCE11} %{buildroot}/opt/rudder/bin/rudder-perl
-
 # Install a profile script to make cf-* part of the PATH
 # AIX does not support profile.d and /etc/profile should not be modified, so we don't do this on AIX at all
 %if "%{?_os}" != "aix"
@@ -298,7 +275,7 @@
 # Build a list of files to include in this package for use in the %files section below
 find %{buildroot}%{rudderdir} %{buildroot}%{ruddervardir} -type f -o -type l | sed "s,%{buildroot},," | sed "s,\.py$,\.py*," | grep -v "%{rudderdir}/etc/uuid.hive" | grep -v "%{ruddervardir}/cfengine-community/ppkeys" > %{_builddir}/file.list.%{name}
 
-%pre -n rudder-agent
+%pre -n rudder-agent-thin
 #=================================================
 # Pre Installation
 #=================================================
@@ -316,7 +293,7 @@
 %endif
 fi
 
-%post -n rudder-agent
+%post -n rudder-agent-thin
 #=================================================
 # Post Installation
 #=================================================
@@ -506,7 +483,7 @@
 # launch rudder agent check script, it will generate an UUID on first install or repair it if needed
 /opt/rudder/bin/check-rudder-agent
 
-%preun -n rudder-agent
+%preun -n rudder-agent-thin
 #=================================================
 # Pre Uninstallation
 #=================================================
@@ -522,7 +499,7 @@
 echo "INFO: A back up copy of the /var/rudder/cfengine-community/ppkeys has been created in /var/backups/rudder"
 
 
-%postun -n rudder-agent
+%postun -n rudder-agent-thin
 #=================================================
 # Post Uninstallation
 #=================================================
@@ -569,7 +546,7 @@
 # Files
 #=================================================
 # Files from %{rudderdir} and %{ruddervardir} are automatically added via the -f option
-%files -n rudder-agent -f %{_builddir}/file.list.%{name}
+%files -n rudder-agent-thin -f %{_builddir}/file.list.%{name}
 %defattr(-, root, root, 0755)
 %config(noreplace) %{rudderdir}/etc/uuid.hive
 %if "%{?_os}" != "aix"
@@ -591,15 +568,8 @@
 # Changelog
 #=================================================
 %changelog
-* Fri Apr  27 2011 - Matthieu CERDA <matthieu.cerda@normation.com> 2.2-beta1-2
-- The packages now builds correctly on both x86 and x86_64 archs, and on EL4/CentOS 4.
-* Tue Mar  1 2011 - Jonathan CLARKE <jonathan.clarke@normation.com> 2.2-beta1-1
-- Release 2.2.beta1
-* Fri Feb 25 2011 - Jonathan CLARKE <jonathan.clarke@normation.com> 2.2-beta0-4
-- Fix bug in postinstall script - stop daemons before replacing them!
-* Fri Feb 25 2011 - Jonathan CLARKE <jonathan.clarke@normation.com> 2.2-beta0-3
-- Fix bug to get initial promises in RPM, using the right git branch
-* Fri Feb 25 2011 - Jonathan CLARKE <jonathan.clarke@normation.com> 2.2-beta0-2
-- Fix bug to get initial promises in RPM
-* Fri Feb 25 2011 - Jonathan CLARKE <jonathan.clarke@normation.com> 2.2-beta0-1
-- Initial package
+* Fri May  30 2014 - Matthieu CERDA <matthieu.cerda@normation.com> 2.11-beta1
+- Initial package, using rudder-agent as a base
+- Removed fusion-inventory code
+- Removed legacy code
+
